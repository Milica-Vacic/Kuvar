{"GET":"let qbGetRat = db.select('*').from('ratings')\r\nlet recId=param('rec_id',null)\r\n\r\nif (recId!==null){\r\n    util.findRecipe(recId)\r\n    qbGetRat.where('rec_id',recId)\r\n\r\n}\r\n\r\nlet res = db.query(qbGetRat.toSql())\r\n\r\nif (res.rows===0){\r\n    write('res','err')\r\n    write('msg','No ratings found')\r\n    exit()\r\n}\r\n\r\nwrite('res','ok')\r\nwrite('data',res)\r\n","POST":"let userId = session('id')\r\nutil.userCheck(userId)\r\nlet recId = param('rec_id',util.requiredParam)\r\nlet rating = param('rating',util.requiredParam)\r\nif (!Number.isInteger(parseInt(rating)) || rating<1 || rating>5){\r\nwrite('res', 'err')\r\nwrite('msg', 'Invalid rating value')\r\nexit()\r\n}\r\n\r\nlet sqlGetRat = db.select('*').from('ratings').where('usr_id',userId).where('rec_id',recId).toSql()\r\nlet res=db.query(sqlGetRat)\r\nlet date = new Date()\r\nif (res.rows>0){\r\n    let sqlUpdate = db.update('ratings').set('rat_value',rating).set('rec_id',recId).set('usr_id',userId).set('rat_input_time',date)\r\n    .where('usr_id',userId).where('rec_id',recId).toSql()\r\n    try{\r\n        db.query(sqlUpdate)\r\n    }\r\n    catch(e){\r\n        write('res','err')\r\n        write('msg', 'SQL error');\r\n        exit();\r\n    }\r\n    write('res','ok')\r\n    exit()\r\n}\r\n\r\nlet sqlIns = db.insert('ratings').set('rat_value',rating).set('rec_id',recId).set('usr_id',userId).set('rat_input_time',date).toSql()\r\ntry{\r\n    db.query(sqlIns)\r\n}\r\ncatch(e){\r\n    write('res','err')\r\n    write('msg', 'SQL error');\r\n    exit();\r\n}\r\n\r\nwrite('res','ok')","META":{"language":"JavaScript"}}